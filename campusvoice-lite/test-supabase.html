<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CampusVoice - Supabase Connection Test</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .test-container {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            max-width: 800px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .test-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .test-header h1 {
            color: #333;
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .test-header p {
            color: #666;
            font-size: 1rem;
        }

        .test-section {
            margin-bottom: 2rem;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            padding: 1.5rem;
            background: #f9f9f9;
        }

        .test-section h3 {
            color: #667eea;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .test-status {
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.8rem;
        }

        .status-icon {
            font-size: 1.5rem;
        }

        .status-pending {
            background: #fff3cd;
            border: 1px solid #ffc107;
            color: #856404;
        }

        .status-success {
            background: #d4edda;
            border: 1px solid #28a745;
            color: #155724;
        }

        .status-error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }

        .status-pending .status-icon {
            color: #ffc107;
        }

        .status-success .status-icon {
            color: #28a745;
        }

        .status-error .status-icon {
            color: #dc3545;
        }

        .test-buttons {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .btn {
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #e0e0e0;
            color: #333;
        }

        .btn-secondary:hover {
            background: #d0d0d0;
        }

        .config-info {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 1rem;
            font-family: monospace;
            font-size: 0.9rem;
            overflow-x: auto;
            color: #666;
        }

        .config-item {
            padding: 0.5rem 0;
            border-bottom: 1px solid #eee;
        }

        .config-item:last-child {
            border-bottom: none;
        }

        .config-label {
            color: #667eea;
            font-weight: bold;
        }

        .results-box {
            background: #f0f0f0;
            border: 1px solid #ccc;
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
            min-height: 100px;
            font-family: monospace;
            font-size: 0.9rem;
            overflow-y: auto;
            max-height: 300px;
            white-space: pre-wrap;
            word-break: break-all;
            color: #333;
        }

        .loading {
            display: inline-block;
            width: 1rem;
            height: 1rem;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1>üß™ Supabase Connection Test</h1>
            <p>Verify your Supabase integration and database connectivity</p>
        </div>

        <!-- Configuration Check -->
        <div class="test-section">
            <h3><i class="fas fa-cog"></i> Configuration Status</h3>
            <div id="configStatus" class="test-status status-pending">
                <span class="status-icon"><i class="fas fa-circle-notch fa-spin"></i></span>
                <span>Checking configuration...</span>
            </div>
            <div class="config-info" id="configInfo"></div>
        </div>

        <!-- Connection Test -->
        <div class="test-section">
            <h3><i class="fas fa-link"></i> Connection Test</h3>
            <div id="connectionStatus" class="test-status status-pending">
                <span class="status-icon"><i class="fas fa-circle-notch fa-spin"></i></span>
                <span>Connecting to Supabase...</span>
            </div>
            <div class="test-buttons">
                <button class="btn btn-primary" onclick="testConnection()">Test Connection</button>
                <button class="btn btn-secondary" onclick="clearResults()">Clear Results</button>
            </div>
            <div class="results-box" id="connectionResults"></div>
        </div>

        <!-- Database Test -->
        <div class="test-section">
            <h3><i class="fas fa-database"></i> Database Operations</h3>
            <div id="dbStatus" class="test-status status-pending">
                <span class="status-icon"><i class="fas fa-circle-notch fa-spin"></i></span>
                <span>Database not tested yet</span>
            </div>
            <div class="test-buttons">
                <button class="btn btn-primary" onclick="testDatabase()">Test Database</button>
                <button class="btn btn-secondary" onclick="testInsert()">Test Insert</button>
            </div>
            <div class="results-box" id="dbResults"></div>
        </div>

        <!-- Back to Dashboard -->
        <div style="text-align: center; margin-top: 2rem;">
            <a href="index.html" class="btn btn-secondary" style="text-decoration: none;">‚Üê Back to Home</a>
        </div>
    </div>

    <script src="config.js"></script>
    <script>
        function log(element, message) {
            const box = document.getElementById(element);
            const timestamp = new Date().toLocaleTimeString();
            box.textContent += `[${timestamp}] ${message}\n`;
            box.scrollTop = box.scrollHeight;
        }

        function clearResults() {
            document.getElementById('connectionResults').textContent = '';
            document.getElementById('dbResults').textContent = '';
        }

        function updateStatus(element, status, message, icon) {
            const el = document.getElementById(element);
            el.className = `test-status status-${status}`;
            
            let iconHtml = '';
            if (status === 'pending') {
                iconHtml = '<i class="fas fa-circle-notch fa-spin"></i>';
            } else if (status === 'success') {
                iconHtml = '<i class="fas fa-check-circle"></i>';
            } else {
                iconHtml = '<i class="fas fa-times-circle"></i>';
            }
            
            el.innerHTML = `<span class="status-icon">${iconHtml}</span><span>${message}</span>`;
        }

        function checkConfiguration() {
            updateStatus('configStatus', 'pending', 'Checking configuration...', '‚öôÔ∏è');
            
            try {
                const hasConfig = typeof SUPABASE_CONFIG !== 'undefined';
                const configHTML = `
URL: ${SUPABASE_CONFIG?.url || 'NOT SET'}
Key: ${SUPABASE_CONFIG?.anonKey ? SUPABASE_CONFIG.anonKey.substring(0, 20) + '...' : 'NOT SET'}
Valid: ${hasConfig ? 'YES' : 'NO'}
                `;
                
                document.getElementById('configInfo').textContent = configHTML.trim();
                
                if (hasConfig && SUPABASE_CONFIG.url && SUPABASE_CONFIG.anonKey) {
                    updateStatus('configStatus', 'success', 'Configuration found ‚úì', '‚úÖ');
                } else {
                    updateStatus('configStatus', 'error', 'Configuration incomplete ‚úó', '‚ùå');
                }
            } catch (error) {
                updateStatus('configStatus', 'error', `Configuration error: ${error.message}`, '‚ùå');
            }
        }

        function testConnection() {
            updateStatus('connectionStatus', 'pending', 'Testing connection...', 'üîÑ');
            log('connectionResults', 'Attempting to connect to Supabase...');
            
            // Simulated test (requires actual Supabase SDK for real test)
            setTimeout(() => {
                try {
                    if (SUPABASE_CONFIG && SUPABASE_CONFIG.url) {
                        log('connectionResults', '‚úì Configuration loaded successfully');
                        log('connectionResults', `‚úì Supabase URL: ${SUPABASE_CONFIG.url}`);
                        log('connectionResults', '‚úì Anonymous key found');
                        log('connectionResults', '‚úì Ready to initialize Supabase client');
                        updateStatus('connectionStatus', 'success', 'Configuration valid ‚úì', '‚úÖ');
                    } else {
                        log('connectionResults', '‚úó Supabase configuration not found');
                        updateStatus('connectionStatus', 'error', 'Configuration missing ‚úó', '‚ùå');
                    }
                } catch (error) {
                    log('connectionResults', `‚úó Error: ${error.message}`);
                    updateStatus('connectionStatus', 'error', `Error: ${error.message}`, '‚ùå');
                }
            }, 1000);
        }

        function testDatabase() {
            updateStatus('dbStatus', 'pending', 'Testing database...', 'üîÑ');
            log('dbResults', 'Testing database connection...');
            log('dbResults', 'Note: Full database test requires Supabase @js package');
            setTimeout(() => {
                log('dbResults', '‚úì Configuration ready for database operations');
                log('dbResults', '‚úì To enable real database tests:');
                log('dbResults', '  1. Install @supabase/supabase-js');
                log('dbResults', '  2. Import createClient from package');
                log('dbResults', '  3. Create client with config credentials');
                updateStatus('dbStatus', 'success', 'Ready for database operations ‚úì', '‚úÖ');
            }, 1000);
        }

        function testInsert() {
            updateStatus('dbStatus', 'pending', 'Testing insert operation...', 'üîÑ');
            log('dbResults', 'Insert test requires Supabase SDK...');
            setTimeout(() => {
                log('dbResults', 'Example insert operation:');
                log('dbResults', '```');
                log('dbResults', 'const { data, error } = await supabase');
                log('dbResults', '  .from("complaints")');
                log('dbResults', '  .insert([{ title: "Test", category: "other" }])');
                log('dbResults', '```');
                updateStatus('dbStatus', 'success', 'Insert test structure shown ‚úì', '‚úÖ');
            }, 1000);
        }

        // Run initial checks
        document.addEventListener('DOMContentLoaded', () => {
            checkConfiguration();
        });
    </script>
</body>
</html>
